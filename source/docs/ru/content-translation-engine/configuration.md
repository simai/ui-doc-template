---
extends: _core._layouts.documentation
section: content
title: 'Движок перевода содержимого - Настройка'
description: 'Движок перевода содержимого - Настройка'
---

# Конфигурация

В этой главе описаны все параметры конфигурации конвейера трансляции и то, как они влияют на входные/выходные каталоги, поставщиков и сборку Jigsaw.

---

## Минимальный конфиг (пример)

```php
<?php
return [
    'source_dir'          => __DIR__ . '/source/',
    'target_lang'         => 'en',          // base locale (source of truth)
    'main'                => __DIR__ . 'configuration.md/', // project root
    'cache_dir'           => 'temp/',

    'frontMatter'         => ['title', 'description'],
    'languages'           => ['ru'],        // target locales to generate
    'output_dir'          => __DIR__ . '/source',
    'preserve_structure'  => true,
];
```

---

## Ключи и семантика

### `source_dir` (строка, обязательна)
Абсолютный путь к вашему **Корень содержимого**. Переводчик сканирует папки языкового стандарта внутри него.

**Конвенция**: Документы для Live Under Venue `source/_docs-<locale>` (например, `_docs-en`, `_docs-ru`).

### `target_lang` (строка, обязательна)
Тем **Местная база** для чтения (например, `en`). Файлы в `source/_docs-<target_lang>` рассматриваются как источник истины.

> Название историческое; Думайте об этом как о `base_lang`.

### `languages` (строка[], обязательна)
Список **Локальная цель** для производства (например, `['ru', 'de']`). Для каждого языка переводчик пишет/обновляет `source/_docs-<lang>`.

### `output_dir` (строка, обязательна)
Корневой путь, по которому записываются локализованные деревья. Обычно то же самое, что и `source_dir` (Таким образом, папки становятся братьями и сестрами, как `_docs-en`, `_docs-ru`).

### `preserve_structure` (bool, по умолчанию: `true`)
Когда `true`, структура каталога/файла в разделе `_docs-<target_lang>` есть **Зеркальные** в каждую целевую папку локали.

### `cache_dir` (строка, обязательна)
Относительный (к `main`) или абсолютный путь для кэшей перевода и конфигурации времени выполнения.

**Верстка (относительно `main`)**:
```
<cache_dir>/translations/
  translate_<lang>.json   # key→translation cache
  hash.json               # checksum/housekeeping
  .config.json            # generated locales map for Jigsaw
```

### `frontMatter` (строка[], необязательный)
Список **Клавиши Front Matter** для перевода (например, `['title','description']`). Поставщику отправляются только эти ключи.

### `main` (строка, обязательна)
Корень проекта; используется для разрешения `cache_dir` и другие относительные пути.

---

## Переменные среды (поставщик)
Поставщик Azure Translator ожидает от вас следующих `.env`:

```
AZURE_KEY=...
AZURE_REGION=...
AZURE_ENDPOINT=https://api.cognitive.microsofttranslator.com
```

> Интерфейс командной строки (`bin/translate`) грузы `.env` перед запуском. Убедитесь, что ключи присутствуют в среде сборки.

---

## Соглашения о каталогах
```
source/
  _docs-en/      # base locale (target_lang)
  _docs-ru/      # generated locale(s)
  ...
```
- **Ввод**: `source/_docs-<target_lang>`
- **Выпуск**: `source/_docs-<lang>` за каждую запись в `languages`

**Типы переведенных файлов**
- Markdown/многомерные выражения (`.md`), клавиши передней материи, перечисленные в `frontMatter`
- Языковые пакеты: `.lang.php`, `.settings.php` (зеркально для местных)

> Транслятор Markdown — это **Поддержка AST**: переводятся только текстовые узлы; Блоки кода, встроенный код, ссылки и пользовательские теги остаются нетронутыми.

---

## Интеграция Jigsaw (обнаружение локали)
В течение `beforeBuild`если `<cache_dir>/translations/.config.json` существует, это есть **слившийся** в `config('locales')`. Это делает доступными вновь сгенерированные языки **без** Редактирование конфигурации проекта.

**Пример`.config.json` (сгенерировано):**
```json
{
  "en": { "name": "English" },
  "ru": { "name": "Русский" }
}
```

Разместите этот файл по адресу `temp/translations/.config.json` если `cache_dir` есть `temp/` и `main` указывает на корень проекта.

---

## Решение путей и советы
- Предпочитать **абсолютный** путей в конфигурации (`__DIR__`), чтобы избежать проблем с CWD.
- Сохраняйте последовательность конечных косых черт (как в примере), чтобы избежать дублирования разделителей при конкатенации.
- Если вы измените `cache_dir`, обновите путь начальной загрузки Jigsaw, который выглядит следующим образом: `.config.json`.

---

## Примеры с несколькими языковыми стандартами
### IN → RU, ОТ
```php
return [
  'target_lang' => 'en',
  'languages'   => ['ru','de'],
  'frontMatter' => ['title','description','summary'],
  // other keys as above
];
```

### RU → EN (местная база – русский)
```php
return [
  'target_lang' => 'ru',
  'languages'   => ['en'],
  'source_dir'  => __DIR__ . '/source/',
  'output_dir'  => __DIR__ . '/source',
  'cache_dir'   => 'temp/',
];
```

---

## Контрольный список для проверки
- `source_dir` существует и содержит `_docs-<target_lang>`.
- `output_dir` является пригодным для записи (или идентичным `source_dir`).
- `languages` не является пустым и не имеет **не** включать `target_lang`.
- `.env` имеет действительные учетные данные Azure.
- Пазл `beforeBuild` Читает `<cache_dir>/translations/.config.json`.

---

## Распространенные ошибки
- **Несовпадающий путь к кэшу**: вы настроили `cache_dir` Но bootstrap все равно читает `temp/translations/.config.json`. Исправьте путь начальной загрузки или набор `cache_dir` Вернуться к `temp/`.
- **Запутанный `target_lang`**: помните, что это **источник** Язык. Цели заходят в `languages`.
- **Относительные пути + CWD**: используйте абсолютные пути с `__DIR__` чтобы избежать неожиданностей при беге из CI.

---
