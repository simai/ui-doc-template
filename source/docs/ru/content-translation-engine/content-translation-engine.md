---
extends: _core._layouts.documentation
section: content
title: 'Движок перевода контента'
description: 'Движок перевода контента'
---

# Движок перевода контента

В этом разделе представлены наши **Конвейер перевода контента**: система, поддерживающая Markdown, которая переводит документацию в несколько локалей с сохранением структуры, пользовательских тегов и лицевой части.

---

## Что он делает
- Переводит исходную документацию из **Местная база** (сконфигурировано как `target_lang`Например.. `en`) в один или несколько **Языки перевода** (например, `ru`).
- Сохраняет форматирование Markdown, блоки кода и **пользовательские теги Markdown** переводя только **Текстовые узлы** в CommonMark AST.
- Сохраняет передние клавиши (например, `title`, `description`) синхронизируются между языковыми стандартами.
- Автоматически кэширует переводы и объединяет локали в сборку Jigsaw.

---

## Высокоуровневый поток
```
Author Markdown (base locale)
        │
        ▼
bin/translate  (CLI) ──► Translator (Azure) ──► Cache (temp/translations/*.json)
        │                          │
        │                          └─ Rate limiting & batching
        ▼
Localized Markdown trees (source/_docs-<lang>)
        │
        ▼
Jigsaw build ── beforeBuild merges temp/translations/.config.json into config('locales')
        │
        ▼
Multi‑locale site output
```

---

## Ключевые точки интеграции
- **Композиторский сценарий**: `"translate": "php bin/translate"` — запускает транслятор CLI.
- **Bootstrap для лобзика**:в `beforeBuild`если `temp/translations/.config.json` существует, его локали **слившийся** в `config('locales')`. Это делает свежепереведенные языки доступными для текущей сборки без изменения конфигурации проекта.

---

## Учет уценки по умолчанию
- Мы создаем CommonMark **Окружающая среда** и установите наш **Расширение "Пользовательские теги"** перед переводом.
- Только **текстовые сегменты** (АСТ `Text` nodes) отправляются провайдеру; Границы кода, встроенный код, ссылки и пользовательские теги остаются нетронутыми.
- Применяется замена **снизу вверх** по диапазонам исходных строк, чтобы избежать смещения позиций при редактировании документа.

---

## Кэширование и идемпотентность
- Каждая исходная строка нормализуется и хешируется; Переводы кэшируются в разделе `temp/translations/translate_<lang>.json`.
- A `hash.json` и удобочитаемый `.config.json` (перечисление локали) также пишутся для бухгалтерии.
- Повторные прогоны **Добавочного**: уже переведенные строки пропускаются.

---

## Ограничение скорости и пакетирование
- Запросы разбиваются на части (≈ 9 тыс. символов на пакет) и регулируются с помощью метода **баков в минуту** Бюджет с джиттером, минимизация троттлинга провайдера.

---

## Что переводится
- **Тела уценки**: только текстовые узлы, с сохранением форматирования.
- **Лицевая сторона**: выбранные клавиши (например, `title`, `description`).
- **Языковые пакеты**: `.lang.php` и `.settings.php` Файлы поддерживаются и дублируются в зависимости от целевого языкового стандарта.

---

## Конфигурация (быстрый просмотр)
Корневой конфигурационный файл (например, `translate.config.php`) управляет путями ввода/вывода и языками:

```php
return [
    'source_dir'          => __DIR__ . '/source/',
    'target_lang'         => 'en',          // base locale (source of truth)
    'main'                => __DIR__ . 'content-translation-engine.md/', // project root
    'cache_dir'           => 'temp/',

    'frontMatter'         => ['title', 'description'],
    'languages'           => ['ru'],        // target locales to produce
    'output_dir'          => __DIR__ . '/source',
    'preserve_structure'  => true,
];
```
> Подробные варианты описаны в следующей главе (**Конфигурация**).

---

## Краткий обзор обязанностей
- **Запись CLI (корзина/перевод)**: bootstraps Composer автозагружается, вызывает транслятор.
- **Translator**: загружает env/keys, собирает среду CommonMark (с пользовательскими тегами), сканирует исходные деревья, переводит строки через провайдера, записывает локализованные деревья и кэши.
- **Поставщик (Azure)**: собственно машинный перевод; Мы занимаемся пакетной обработкой, регулированием и отчетами об ошибках.
- **Пазл **: объединяет локали времени выполнения из `.config.json` перед сборкой, чтобы сделать видимыми новые языки.

---

## Принципы безопасности и корректности
- **Сохранение структуры**: никогда не переводите названия тегов, код или разметку.
- **Детерминированные слияния**: классы и атрибуты в пользовательских тегах остаются нетронутыми; Изменяется только текстовое содержимое.
- **Безотказный громкий** об ошибках конфигурации; **тайник** агрессивно, чтобы избежать дублирования затрат.

---

